---
title: "@soundblue/i18n"
description: URLベースi18nルーティングとParaglide統合 - Layer 2 ドメインパッケージ
sidebar:
  order: 6
---

# @soundblue/i18n

**Layer 2 (ドメイン)** — URLベースの国際化ルーティングとParaglide統合。

## 概要

このパッケージは、React Router v7のSSR/SSGモード用のi18nルーティングを提供します。英語がデフォルト、韓国語は`/ko`プレフィックスでルーティングされます。

| プロパティ | 値 |
|----------|-------|
| レイヤー | 2 (ドメイン) |
| 依存関係 | @inlang/paraglide-js |
| React必須 | いいえ（コアユーティリティ） |
| 環境 | ユニバーサル |

## インストール

```json
{
  "dependencies": {
    "@soundblue/i18n": "workspace:*"
  }
}
```

## URL構造

```
/entry/hello     → 英語 (デフォルト)
/ko/entry/hello  → 韓国語
```

## エクスポート

### ルーティングユーティリティ

```typescript
import {
  stripLocaleFromPath,
  getLocaleFromPath,
  generateI18nRoutes,
  extractStaticRoutes
} from '@soundblue/i18n';

// URLからロケールを除去
stripLocaleFromPath('/ko/entry/hello');  // '/entry/hello'
stripLocaleFromPath('/entry/hello');      // '/entry/hello'

// URLからロケールを取得
getLocaleFromPath('/ko/about');    // 'ko'
getLocaleFromPath('/about');       // 'en'

// 両ロケール用のルートを生成
const routes = generateI18nRoutes(
  entries,
  (entry) => `/entry/${entry.id}`
);
// ['/entry/hello', '/ko/entry/hello', ...]

// 静的ルートをフラット化して抽出
const staticRoutes = extractStaticRoutes(routeManifest);
// ['/', '/about', '/ko', '/ko/about']
```

### メタファクトリー

React Routerメタタグ用。

```typescript
import { metaFactory } from '@soundblue/i18n';

// 静的ルート
export const meta = metaFactory({
  ko: { title: '소개', description: '한국어 사전 소개' },
  en: { title: 'About', description: 'About the dictionary' },
}, 'https://context.soundbluemusic.com');
```

### React Router 設定例

**SSGモード (Roots):**

```typescript
// react-router.config.ts
export default {
  ssr: false,  // SSGモード - Rootsのみ
  async prerender() {
    const staticRoutes = extractStaticRoutes(routes);
    const conceptRoutes = generateI18nRoutes(concepts, (c) => `/concept/${c.id}`);
    return [...staticRoutes, ...conceptRoutes];
  },
} satisfies Config;
```

**SSRモード (Context/Permissive):**

```typescript
// react-router.config.ts
export default {
  ssr: true,  // SSRモード - Context, Permissive
  async prerender() {
    // 静的ページのみprerender
    return [...staticRoutes, ...categoryRoutes];
  },
} satisfies Config;
```

## Paraglide統合

### セットアップ

```typescript
// app/root.tsx
import { setLanguageTag, sourceLanguageTag } from '@/paraglide/runtime';

export async function loader({ request }: LoaderArgs) {
  const locale = getLocaleFromPath(new URL(request.url).pathname);
  setLanguageTag(locale);
  return { locale };
}
```

### 翻訳を使用

```typescript
// components/Header.tsx
import * as m from '@/paraglide/messages';

function Header() {
  return (
    <header>
      <h1>{m.siteTitle()}</h1>
      <nav>
        <a href="/">{m.home()}</a>
        <a href="/about">{m.about()}</a>
      </nav>
    </header>
  );
}
```

### メッセージファイル

```json
// messages/en.json
{
  "siteTitle": "Context Dictionary",
  "home": "Home",
  "about": "About",
  "search": "Search..."
}

// messages/ko.json
{
  "siteTitle": "Context 사전",
  "home": "홈",
  "about": "소개",
  "search": "검색..."
}
```

## 言語切り替え

```typescript
// components/LanguageToggle.tsx
import { getLocaleFromPath, stripLocaleFromPath } from '@soundblue/i18n';

function LanguageToggle() {
  const location = useLocation();
  const currentLocale = getLocaleFromPath(location.pathname);
  const basePath = stripLocaleFromPath(location.pathname);

  const switchTo = currentLocale === 'ko' ? basePath : `/ko${basePath}`;

  return (
    <Link to={switchTo}>
      {currentLocale === 'ko' ? 'English' : '한국어'}
    </Link>
  );
}
```

## サポートロケール

| ロケール | URLプレフィックス | 説明 |
|--------|-----------------|------|
| `en` | なし (デフォルト) | 英語 |
| `ko` | `/ko` | 韓国語 |

## ベストプラクティス

1. **URLベースのロケール** - SEOと共有可能性のため
2. **デフォルトロケールにプレフィックスなし** - 英語URLをクリーンに
3. **メタファクトリーを使用** - 両ロケールの一貫したSEOを保証
4. **hreflangタグを追加** - 検索エンジンが言語代替を理解
