name: Deploy Documentation to GitHub Pages

on:
  # Trigger on push to main branch
    push:
        branches: [main]
            paths:
                  - 'docs/docs-site/**'
                        - 'README.md'
                              - 'ARCHITECTURE.md'
                                    - 'CLAUDE.md'
                                          - '.github/workflows/deploy-docs.yml'
                                            # Allow manual trigger
                                              workflow_dispatch:

                                              # Allow this job to clone the repo and create a page deployment
                                              permissions:
                                                contents: read
                                                  pages: write
                                                    id-token: write

                                                    # Allow only one concurrent deployment
                                                    concurrency:
                                                      group: pages
                                                        cancel-in-progress: false

                                                        jobs:
                                                          build:
                                                              name: Build Documentation
                                                                  runs-on: ubuntu-latest
                                                                      steps:
                                                                            - name: Checkout repository
                                                                                    uses: actions/checkout@v5

                                                                                          - name: Setup pnpm
                                                                                                  uses: pnpm/action-setup@v4

                                                                                                        - name: Setup Node.js
                                                                                                                uses: actions/setup-node@v4
                                                                                                                        with:
                                                                                                                                  node-version: 22
                                                                                                                                            cache: 'pnpm'
                                                                                                                                            
                                                                                                                                                  - name: Install dependencies
                                                                                                                                                          working-directory: docs/docs-site
                                                                                                                                                                  run: pnpm install
                                                                                                                                                                  
                                                                                                                                                                        - name: Build documentation site
                                                                                                                                                                                working-directory: docs/docs-site
                                                                                                                                                                                        run: pnpm build
                                                                                                                                                                                        
                                                                                                                                                                                              - name: Upload artifact
                                                                                                                                                                                                      uses: actions/upload-pages-artifact@v3
                                                                                                                                                                                                              with:
                                                                                                                                                                                                                        path: docs/docs-site/dist
                                                                                                                                                                                                                        
                                                                                                                                                                                                                          deploy:
                                                                                                                                                                                                                              name: Deploy to GitHub Pages
                                                                                                                                                                                                                                  needs: build
                                                                                                                                                                                                                                      runs-on: ubuntu-latest
                                                                                                                                                                                                                                          environment:
                                                                                                                                                                                                                                                name: github-pages
                                                                                                                                                                                                                                                      url: ${{ steps.deployment.outputs.page_url }}
                                                                                                                                                                                                                                                          steps:
                                                                                                                                                                                                                                                                - name: Deploy to GitHub Pages
                                                                                                                                                                                                                                                                        id: deployment
                                                                                                                                                                                                                                                                                uses: actions/deploy-pages@v4
