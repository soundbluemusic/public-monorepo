name: Delete Pages Projects

on:
  workflow_dispatch:

jobs:
  delete:
    runs-on: ubuntu-latest
    steps:
      - name: Install cloudflare-bulk-delete and destroy projects
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          CLOUDFLARE_ACCOUNT_ID: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
        run: |
          npm install -g cloudflare-bulk-delete

          echo "=== Destroying ro0ts Pages project ==="
          cf-bulk-delete destroy pages ro0ts \
            --token "$CLOUDFLARE_API_TOKEN" \
            --account "$CLOUDFLARE_ACCOUNT_ID" \
            --yes || echo "ro0ts destruction failed or already deleted"

          echo "=== Destroying permissive Pages project ==="
          cf-bulk-delete destroy pages permissive \
            --token "$CLOUDFLARE_API_TOKEN" \
            --account "$CLOUDFLARE_ACCOUNT_ID" \
            --yes || echo "permissive destruction failed or already deleted"

      - name: Verify deletion
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          CLOUDFLARE_ACCOUNT_ID: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
        run: |
          npm install -g cloudflare-bulk-delete
          echo "=== Remaining Pages projects ==="
          cf-bulk-delete list --token "$CLOUDFLARE_API_TOKEN" --account "$CLOUDFLARE_ACCOUNT_ID"
